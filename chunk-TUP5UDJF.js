import{W as G}from"./chunk-VFXAHBRT.js";import{Z as M,a as N,b as L,ba as K,d as $,k as O}from"./chunk-UBSBWSUK.js";var U=class T{constructor(e){this.router=e;this.loadRecentFiles()}RECENT_FILES_KEY="ezReaderRecentFiles";recentFilesSubject=new O([]);recentFiles$=this.recentFilesSubject.asObservable();config={maxRecentFiles:5,supportedImageFormats:["image/jpeg","image/png","image/gif","image/webp"],supportedDocumentFormats:["application/pdf",".doc",".docx",".txt"],maxFileSize:50*1024*1024};loadRecentFiles(){let e=localStorage.getItem(this.RECENT_FILES_KEY),t=e?JSON.parse(e):[];return this.recentFilesSubject.next(t),t}saveRecentFiles(e){try{let t=JSON.stringify(e);if(new Blob([t]).size>5*1024*1024){console.warn("Recent files data is too large, reducing...");let n=e.slice(0,Math.floor(e.length/2));localStorage.setItem(this.RECENT_FILES_KEY,JSON.stringify(n)),this.recentFilesSubject.next(n);return}localStorage.setItem(this.RECENT_FILES_KEY,t),this.recentFilesSubject.next(e)}catch(t){if(console.error("Failed to save recent files:",t),t instanceof DOMException&&t.name==="QuotaExceededError"){this.clearExcessiveData();let o=e.map(n=>({name:n.name,date:n.date,size:n.size,data:""})).slice(0,3);try{localStorage.setItem(this.RECENT_FILES_KEY,JSON.stringify(o)),this.recentFilesSubject.next(o)}catch(n){console.error("Failed to save even reduced data:",n),localStorage.removeItem(this.RECENT_FILES_KEY),this.recentFilesSubject.next([])}}}}clearExcessiveData(){try{["currentPdf","currentPdfName","pdfData"].forEach(n=>{let r=localStorage.getItem(n);r&&r.length>1024*1024&&(localStorage.removeItem(n),console.log(`Removed large localStorage item: ${n}`))});let t=this.loadRecentFiles(),o=t.map(n=>L(N({},n),{data:n.data&&n.data.length>1e4?"":n.data}));(o.length!==t.length||o.some((n,r)=>n.data!==t[r].data))&&localStorage.setItem(this.RECENT_FILES_KEY,JSON.stringify(o))}catch(e){console.error("Failed to clear excessive data:",e)}}addRecentFile(e,t,o){let n=new Date().toISOString(),r=this.recentFilesSubject.value,a=t.length<100*1024,l=a?t:"";a||console.log(`File ${e} is too large, storing metadata only`);let c=[{name:e,date:n,data:l,size:o},...r.filter(g=>g.name!==e)].slice(0,this.config.maxRecentFiles);this.saveRecentFiles(c)}deleteRecentFile(e){let o=this.recentFilesSubject.value.filter(n=>n.name!==e.name);this.saveRecentFiles(o)}handleFileUpload(e,t=!1){return new Promise(o=>{let n=document.createElement("input");n.type="file",n.multiple=t,n.accept=e.join(","),n.onchange=r=>{o(r.target.files)},n.onclick=()=>{setTimeout(()=>{n.files||o(null)},1e3)},n.click()})}processPdfFile(e){return $(this,null,function*(){return new Promise((t,o)=>{let n=new FileReader;n.onload=()=>{let r=n.result;this.addRecentFile(e.name,r,this.formatFileSize(e.size)),t(r)},n.onerror=()=>o(n.error),n.readAsDataURL(e)})})}openInViewer(e,t,o="desktop"){let n=o==="mobile"?"/mobile/viewer":"/viewer";this.router.navigate([n],{state:{pdfData:e,name:t}})}formatFileSize(e){if(e===0)return"0 Bytes";let t=1024,o=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,n)).toFixed(2))+" "+o[n]}handleFileDrop(e){e.preventDefault();let t=e.dataTransfer?.files;if(t&&t.length>0){let o=t[0];if(o.type==="application/pdf"||o.name.toLowerCase().endsWith(".pdf"))return o;{let r=new CustomEvent("show-snackbar",{detail:{message:"PDF \uD30C\uC77C\uB9CC \uC5C5\uB85C\uB4DC\uD560 \uC218 \uC788\uC2B5\uB2C8\uB2E4."}});return document.dispatchEvent(r),null}}return null}handleFileAction(e,t){return $(this,null,function*(){switch(e){case"open":t.length>0&&t[0].data&&this.openInViewer(t[0].data,t[0].name);break;case"share":console.log("\uACF5\uC720 \uAE30\uB2A5\uC774 \uC120\uD0DD\uB418\uC5C8\uC2B5\uB2C8\uB2E4.");break;case"rename":console.log("\uC774\uB984\uBCC0\uACBD \uAE30\uB2A5\uC774 \uC120\uD0DD\uB418\uC5C8\uC2B5\uB2C8\uB2E4.");break;case"copy":console.log("\uBCF5\uC81C \uAE30\uB2A5\uC774 \uC120\uD0DD\uB418\uC5C8\uC2B5\uB2C8\uB2E4.");break;case"delete":console.log("\uC0AD\uC81C \uAE30\uB2A5\uC774 \uC120\uD0DD\uB418\uC5C8\uC2B5\uB2C8\uB2E4.");break;default:console.warn("\uC54C \uC218 \uC5C6\uB294 \uC561\uC158:",e)}})}getStorageInfo(){let e=0;for(let n in localStorage)localStorage.hasOwnProperty(n)&&(e+=localStorage.getItem(n)?.length||0);let t=5*1024*1024,o=e/t*100;return{used:e,total:t,percentage:o}}clearAllRecentFiles(){localStorage.removeItem(this.RECENT_FILES_KEY),this.recentFilesSubject.next([]),console.log("All recent files cleared")}emergencyCleanup(){let e=this.getStorageInfo();console.log("Emergency cleanup triggered. Storage usage:",e);let t=Object.keys(localStorage).filter(o=>o.startsWith("ezReader")||o.includes("pdf")||o.includes("Pdf")||o==="currentPdf"||o==="currentPdfName");t.forEach(o=>{localStorage.removeItem(o)}),this.recentFilesSubject.next([]),console.log(`Removed ${t.length} items from localStorage`)}static \u0275fac=function(t){return new(t||T)(K(G))};static \u0275prov=M({token:T,factory:T.\u0275fac,providedIn:"root"})};var Y=class T{getConversionOptions(){return[{id:"image",title:"\uC774\uBBF8\uC9C0 \u2192 PDF",icon:"./images/ico-img@3x.png",acceptTypes:["image/*"]},{id:"excel",title:"\uC5D1\uC140 \u2192 PDF",icon:"./images/btn-gnb-xls@3x.png",acceptTypes:[".xlsx",".xls"]},{id:"powerpoint",title:"\uD30C\uC6CC\uD3EC\uC778\uD2B8 \u2192 PDF",icon:"./images/btn-gnb-ppt@3x.png",acceptTypes:[".pptx",".ppt"]},{id:"word",title:"\uC6CC\uB4DC \u2192 PDF",icon:"./images/btn-gnb-doc@3x.png",acceptTypes:[".docx",".doc"]}]}getUploadOptions(){return[{id:"file",title:"\uD30C\uC77C",icon:"",acceptTypes:[".pdf",".doc",".docx",".txt"]},{id:"photo",title:"\uC0AC\uC9C4",icon:"",acceptTypes:["image/*"]},{id:"pdf",title:"PDF",icon:"",acceptTypes:[".pdf"]}]}convertFiles(e,t,o){return $(this,null,function*(){try{return console.log(`${t} \uBCC0\uD658 \uC2DC\uC791:`,e.length,"\uAC1C \uD30C\uC77C"),console.log("\uBCC0\uD658 \uC124\uC815:",o),yield this.simulateConversion(e.length),console.log("\uBCC0\uD658 \uC644\uB8CC"),!0}catch(n){return console.error("\uBCC0\uD658 \uC2E4\uD328:",n),!1}})}simulateConversion(e){return $(this,null,function*(){return new Promise(t=>{setTimeout(t,1e3+e*500)})})}getDefaultSettings(){return{fileName:"\uBCC0\uD658\uB41C_\uD30C\uC77C",savePath:"/Users/Downloads",quality:80,format:"pdf"}}validateFileType(e,t){let o=e.name.toLowerCase(),n=e.type;return t.some(r=>{if(r.startsWith("."))return o.endsWith(r);if(r.includes("/*")){let a=r.split("/")[0];return n.startsWith(a)}else return n===r})}getSupportedFormatsMessage(e){return`\uC9C0\uC6D0 \uD615\uC2DD: ${e.join(", ")}`}static \u0275fac=function(t){return new(t||T)};static \u0275prov=M({token:T,factory:T.\u0275fac,providedIn:"root"})};var J=class T{fontData=null;constructor(){this.loadKoreanFont()}parseColor(e){let t={r:0,g:0,b:0};if(!e)return t;if(e.startsWith("#")){let r=e.slice(1);if(r.length===6)return{r:parseInt(r.slice(0,2),16)/255,g:parseInt(r.slice(2,4),16)/255,b:parseInt(r.slice(4,6),16)/255};if(r.length===3)return{r:parseInt(r[0]+r[0],16)/255,g:parseInt(r[1]+r[1],16)/255,b:parseInt(r[2]+r[2],16)/255}}let o=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*[\d.]+)?\)/);return o?{r:parseInt(o[1])/255,g:parseInt(o[2])/255,b:parseInt(o[3])/255}:{black:{r:0,g:0,b:0},white:{r:1,g:1,b:1},red:{r:1,g:0,b:0},green:{r:0,g:1,b:0},blue:{r:0,g:0,b:1},yellow:{r:1,g:1,b:0},cyan:{r:0,g:1,b:1},magenta:{r:1,g:0,b:1},gray:{r:.5,g:.5,b:.5},grey:{r:.5,g:.5,b:.5}}[e.toLowerCase()]||t}loadKoreanBoldFont(){return $(this,null,function*(){try{let e=yield fetch("/fonts/NanumGothic-Bold.ttf");if(e.ok){let t=yield e.arrayBuffer();return console.log("\uB85C\uCEEC \uB098\uB214\uACE0\uB515 Bold \uD3F0\uD2B8 \uB85C\uB4DC \uC131\uACF5"),t}}catch(e){console.log("\uB85C\uCEEC Bold \uD3F0\uD2B8 \uB85C\uB4DC \uC2E4\uD328:",e)}try{let e=yield fetch("https://github.com/google/fonts/raw/main/ofl/nanumgothic/NanumGothic-Bold.ttf");if(e.ok){let t=yield e.arrayBuffer();return console.log("GitHub \uB098\uB214\uACE0\uB515 Bold \uD3F0\uD2B8 \uB85C\uB4DC \uC131\uACF5"),t}}catch(e){console.log("GitHub Bold \uD3F0\uD2B8 \uB85C\uB4DC \uC2E4\uD328:",e)}return console.log("Bold \uD3F0\uD2B8 \uB85C\uB4DC \uC2E4\uD328, \uC77C\uBC18 \uD3F0\uD2B8 \uC0AC\uC6A9"),null})}loadKoreanFont(){return $(this,null,function*(){if(this.fontData)return!0;try{let e=yield fetch("/fonts/NanumGothic-Regular.ttf");if(e.ok)return this.fontData=yield e.arrayBuffer(),console.log("\uB85C\uCEEC \uB098\uB214\uACE0\uB515 \uD3F0\uD2B8 \uB85C\uB4DC \uC131\uACF5"),!0}catch(e){console.log("\uB85C\uCEEC \uD3F0\uD2B8 \uB85C\uB4DC \uC2E4\uD328:",e)}try{let e=yield fetch("https://github.com/google/fonts/raw/main/ofl/nanumgothic/NanumGothic-Regular.ttf");if(e.ok)return this.fontData=yield e.arrayBuffer(),console.log("GitHub \uB098\uB214\uACE0\uB515 \uD3F0\uD2B8 \uB85C\uB4DC \uC131\uACF5"),!0}catch(e){console.log("GitHub \uD3F0\uD2B8 \uB85C\uB4DC \uC2E4\uD328:",e)}try{let e=yield fetch("https://cdn.jsdelivr.net/gh/google/fonts@main/ofl/nanumgothic/NanumGothic-Regular.ttf");if(e.ok)return this.fontData=yield e.arrayBuffer(),console.log("CDN \uB098\uB214\uACE0\uB515 \uD3F0\uD2B8 \uB85C\uB4DC \uC131\uACF5"),!0}catch(e){console.log("CDN \uD3F0\uD2B8 \uB85C\uB4DC \uC2E4\uD328:",e)}return console.warn("\uBAA8\uB4E0 \uD55C\uAE00 \uD3F0\uD2B8 \uB85C\uB4DC \uC2DC\uB3C4 \uC2E4\uD328"),!1})}embedKoreanFont(e){return $(this,null,function*(){try{if(yield this.loadKoreanFont(),this.fontData){window.fontkit||(console.log("fontkit \uB77C\uC774\uBE0C\uB7EC\uB9AC \uB85C\uB529 \uC911..."),yield new Promise((o,n)=>{let r=document.createElement("script");r.src="https://unpkg.com/@pdf-lib/fontkit@1.1.1/dist/fontkit.umd.min.js",r.onload=()=>{console.log("fontkit \uB85C\uB529 \uC644\uB8CC"),o(!0)},r.onerror=()=>{n(new Error("fontkit \uB85C\uB529 \uC2E4\uD328"))},document.head.appendChild(r)})),e.registerFontkit(window.fontkit);let t=yield e.embedFont(new Uint8Array(this.fontData));return console.log("\uD55C\uAE00 \uD3F0\uD2B8 \uC784\uBCA0\uB4DC \uC131\uACF5"),t}}catch(t){console.error("\uD55C\uAE00 \uD3F0\uD2B8 \uC784\uBCA0\uB4DC \uC2E4\uD328:",t)}return null})}containsKorean(e){return/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/.test(e)}modifyPdfTextStream(e,t){return $(this,null,function*(){try{console.log("=== PDF \uD14D\uC2A4\uD2B8 \uC2A4\uD2B8\uB9BC \uC218\uC815 \uC0C1\uC138 \uB85C\uADF8 \uC2DC\uC791 ==="),console.log("\uC785\uB825 PDF \uD06C\uAE30:",e.byteLength,"\uBC14\uC774\uD2B8"),console.log("\uC218\uC815\uC0AC\uD56D \uAC1C\uC218:",t.length),t.forEach((i,D)=>{console.log(`[\uC218\uC815\uC0AC\uD56D ${D+1}/${t.length}] \uC6D0\uBCF8: "${i.originalText}" \u2192 \uC218\uC815: "${i.newText}"`)}),console.log("PDF \uC644\uC804 \uC7AC\uC0DD\uC131 \uBC29\uC2DD\uC73C\uB85C \uD14D\uC2A4\uD2B8 \uC218\uC815 \uC2DC\uC791");let o=yield this.loadPdfLib(),n=window.pdfjsLib;if(!n)throw new Error("PDF.js \uB77C\uC774\uBE0C\uB7EC\uB9AC\uAC00 \uB85C\uB4DC\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.");let a=yield n.getDocument({data:e.slice(0)}).promise;console.log(`PDF \uB85C\uB4DC \uC644\uB8CC: ${a.numPages}\uD398\uC774\uC9C0`);let l=[];for(let i=1;i<=a.numPages;i++){let D=yield a.getPage(i),I=yield D.getTextContent(),C=D.getViewport({scale:1}),k={pageNum:i,width:C.width,height:C.height,textItems:I.items.map(B=>{let s=B.transform,f=s[4],d=s[5],y=Math.abs(s[0]);return{text:B.str,x:f,y:d,fontSize:y,fontName:B.fontName||"Helvetica",transform:s}})};l.push(k),console.log(`\uD398\uC774\uC9C0 ${i}: ${k.textItems.length}\uAC1C \uD14D\uC2A4\uD2B8 \uCD94\uCD9C`)}console.log("\uC0C8 PDF \uBB38\uC11C \uC0DD\uC131 \uC911...");let c=yield o.PDFDocument.create();console.log("\uD55C\uAE00 \uD3F0\uD2B8 \uC784\uBCA0\uB4DC \uC911...");let g=yield this.embedKoreanFont(c),E=yield o.PDFDocument.load(e.slice(0));try{E.getTitle()&&c.setTitle(E.getTitle()),E.getAuthor()&&c.setAuthor(E.getAuthor()),c.setProducer("ezReader Text Modifier with Korean Support"),c.setModificationDate(new Date)}catch(i){console.warn("\uBA54\uD0C0\uB370\uC774\uD130 \uBCF5\uC0AC \uC2E4\uD328:",i)}let R=0;for(let i of l){console.log(`\uD398\uC774\uC9C0 ${i.pageNum} \uC7AC\uAD6C\uC131 \uC911...`);let D=c.addPage([i.width,i.height]);D.drawRectangle({x:0,y:0,width:i.width,height:i.height,color:o.rgb(1,1,1),opacity:1}),console.log(`\uD398\uC774\uC9C0 ${i.pageNum} \uC804\uCCB4 \uD14D\uC2A4\uD2B8 \uC7AC\uAD6C\uC131 \uC2DC\uC791 (\uCD1D ${i.textItems.length}\uAC1C \uD56D\uBAA9)`);let I=new Set,C=[];console.log(`
=== \uD398\uC774\uC9C0 ${i.pageNum} \uC218\uC815\uC0AC\uD56D \uCC98\uB9AC \uC2DC\uC791 ===`),console.log(`\uCC98\uB9AC\uD560 \uC218\uC815\uC0AC\uD56D \uC218: ${t.length}\uAC1C`);for(let s=0;s<t.length;s++){let f=t[s],d=f.originalText.trim(),y=f.newText.trim();console.log(`
[\uC218\uC815\uC0AC\uD56D ${s+1}/${t.length}] \uCC98\uB9AC \uC2DC\uC791`),console.log(`\uC6D0\uBCF8 \uD14D\uC2A4\uD2B8: "${d}"`),console.log(`\uC0C8 \uD14D\uC2A4\uD2B8: "${y}"`);let u=this.groupTextItemsBySentence(i.textItems);console.log(`  \u{1F4DD} \uD398\uC774\uC9C0 ${i.pageNum}: ${u.length}\uAC1C \uBB38\uC7A5 \uADF8\uB8F9 \uC0DD\uC131`);let x=!1,w=-1,v=-1,p=null;for(let h of u){let m=h.text.replace(/\s+/g," ").trim(),F=d.replace(/\s+/g," ").trim();console.log(`  \u{1F50D} \uBB38\uC7A5 \uADF8\uB8F9 \uC815\uD655\uC131 \uAC80\uC0AC: "${m}"`),console.log(`  \u{1F3AF} \uCC3E\uB294 \uC6D0\uBCF8 \uD14D\uC2A4\uD2B8: "${F}"`);let S=m===F,b=m.includes(F)&&F.length>=5,z=this.calculateSimilarity(m,F)>.8;if(S||b||z){console.log("  \u2705 \uC815\uD655\uD55C \uBB38\uC7A5 \uB9E4\uCE6D \uC131\uACF5! \uD574\uB2F9 \uBB38\uC7A5\uB9CC \uC644\uC804 \uC0AD\uC81C\uD558\uACE0 \uC0C8 \uB0B4\uC6A9\uC73C\uB85C \uAD50\uCCB4"),console.log(`  \u{1F4CD} \uC0AD\uC81C\uD560 \uC815\uD655\uD55C \uBB38\uC7A5: "${m}"`),console.log(`  \u{1F4CA} \uB9E4\uCE6D \uC720\uD615: ${S?"\uC815\uD655\uC77C\uCE58":b?"\uD3EC\uD568\uAD00\uACC4":"\uB192\uC740\uC720\uC0AC\uB3C4"}`),z&&console.log(`  \u{1F4CA} \uC720\uC0AC\uB3C4: ${(this.calculateSimilarity(m,F)*100).toFixed(1)}%`),console.log(`  \u{1F5D1}\uFE0F \uC815\uD655\uD55C \uBB38\uC7A5 \uB0B4 \uD14D\uC2A4\uD2B8 \uD56D\uBAA9 \uC81C\uAC70 \uC2DC\uC791 (\uCD1D ${h.items.length}\uAC1C)`);for(let j=0;j<i.textItems.length;j++){let A=i.textItems[j];this.isItemInSentenceGroup(A,h)&&(I.add(j),console.log(`    \u274C \uC815\uD655\uD55C \uC81C\uAC70 \uB300\uC0C1 \uCD94\uAC00: [${j}] "${A.text}"`),w===-1&&(w=j,p={x:h.x,y:h.y,fontSize:A.fontSize,fontName:A.fontName}),v=j)}x=!0,console.log(`  \u{1F4CB} \uC815\uD655\uD55C \uC0AD\uC81C \uBC94\uC704: \uC778\uB371\uC2A4 ${w}~${v} (\uCD1D ${v-w+1}\uAC1C \uD56D\uBAA9)`);break}}if(x&&p){for(let h=w;h<=v;h++)I.add(h),console.log(`  \uC81C\uAC70 \uB300\uC0C1: [${h}] "${i.textItems[h].text}"`);C.push({text:y,x:p.x,y:p.y,fontSize:f.font?.size||p.fontSize,fontName:f.font?.name||p.fontName,color:f.font?.color?(()=>{let h=this.parseColor(f.font.color);return o.rgb(h.r,h.g,h.b)})():o.rgb(.1,.6,.1),font:f.font,modificationIndex:s}),R++,console.log(`  \u2705 [\uC218\uC815\uC0AC\uD56D ${s+1}] \uB9E4\uCE6D \uC131\uACF5: "${d}" \u2192 "${y}"`),console.log(`  \uC704\uCE58: (${p.x}, ${p.y}), \uD3F0\uD2B8: ${p.fontSize}px`)}else{console.log(`  \u274C [\uC218\uC815\uC0AC\uD56D ${s+1}] \uBB38\uC7A5 \uB2E8\uC704 \uB9E4\uCE6D \uC2E4\uD328: "${d}"\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC74C`);let h=d.split(" ").filter(m=>m.length>=3);if(h.length>0){console.log(`  \u{1F50D} \uD0A4\uC6CC\uB4DC \uAE30\uBC18 \uC804\uCCB4 \uBB38\uC7A5 \uC0AD\uC81C \uBC0F \uAD50\uCCB4 \uC2DC\uB3C4: [${h.join(", ")}]`);for(let m of u){let F=m.text.toLowerCase(),S=0;for(let b of h)F.includes(b.toLowerCase())&&S++;if(S>=Math.ceil(h.length/2)){console.log("  \u2705 \uD0A4\uC6CC\uB4DC \uAE30\uBC18 \uB9E4\uCE6D! \uC804\uCCB4 \uBB38\uC7A5 \uC644\uC804 \uC0AD\uC81C \uD6C4 \uC0C8 \uB0B4\uC6A9\uC73C\uB85C \uAD50\uCCB4"),console.log(`  \u{1F5D1}\uFE0F \uC0AD\uC81C\uD560 \uC804\uCCB4 \uBB38\uC7A5: "${m.text}"`),console.log(`  \u{1F4CA} \uB9E4\uCE6D\uB41C \uD0A4\uC6CC\uB4DC: ${S}/${h.length}\uAC1C`),console.log(`  \u2795 \uC0C8\uB85C \uCD94\uAC00\uD560 \uB0B4\uC6A9: "${y}"`),console.log(`  \u{1F5D1}\uFE0F \uBB38\uC7A5 \uB0B4 \uBAA8\uB4E0 \uD14D\uC2A4\uD2B8 \uD56D\uBAA9 \uC644\uC804 \uC0AD\uC81C \uC2DC\uC791 (\uCD1D ${m.items.length}\uAC1C)`);for(let b=0;b<i.textItems.length;b++){let z=i.textItems[b];this.isItemInSentenceGroup(z,m)&&(I.add(b),console.log(`    \u274C \uC644\uC804 \uC0AD\uC81C \uB300\uC0C1 \uCD94\uAC00: [${b}] "${z.text}"`),w===-1&&(w=b,p={x:m.x,y:m.y,fontSize:z.fontSize,fontName:z.fontName}),v=b)}x=!0,console.log(`  \u{1F4CB} \uD0A4\uC6CC\uB4DC \uAE30\uBC18 \uC644\uC804 \uC0AD\uC81C \uBC94\uC704: \uC778\uB371\uC2A4 ${w}~${v} (\uCD1D ${v-w+1}\uAC1C \uD56D\uBAA9)`);break}}}if(!x){let m=d.split(" ")[0];if(m&&m.length>=3){console.log(`  \u{1F50D} \uCCAB \uB2E8\uC5B4 \uAE30\uBC18 \uC804\uCCB4 \uBB38\uC7A5 \uC0AD\uC81C \uBC0F \uAD50\uCCB4 \uC2DC\uB3C4: "${m}"`);for(let F of u)if(F.text.toLowerCase().includes(m.toLowerCase())){console.log("  \u2705 \uCCAB \uB2E8\uC5B4 \uAE30\uBC18 \uB9E4\uCE6D! \uC804\uCCB4 \uBB38\uC7A5 \uC644\uC804 \uC0AD\uC81C \uD6C4 \uC0C8 \uB0B4\uC6A9\uC73C\uB85C \uAD50\uCCB4"),console.log(`  \u{1F5D1}\uFE0F \uC0AD\uC81C\uD560 \uC804\uCCB4 \uBB38\uC7A5: "${F.text}"`),console.log(`  \u2795 \uC0C8\uB85C \uCD94\uAC00\uD560 \uB0B4\uC6A9: "${y}"`),console.log(`  \u{1F5D1}\uFE0F \uBB38\uC7A5 \uB0B4 \uBAA8\uB4E0 \uD14D\uC2A4\uD2B8 \uD56D\uBAA9 \uC644\uC804 \uC0AD\uC81C \uC2DC\uC791 (\uCD1D ${F.items.length}\uAC1C)`);for(let S=0;S<i.textItems.length;S++){let b=i.textItems[S];this.isItemInSentenceGroup(b,F)&&(I.add(S),console.log(`    \u274C \uC644\uC804 \uC0AD\uC81C \uB300\uC0C1 \uCD94\uAC00: [${S}] "${b.text}"`),w===-1&&(w=S,p={x:F.x,y:F.y,fontSize:b.fontSize,fontName:b.fontName}),v=S)}x=!0,console.log(`  \u{1F4CB} \uCCAB \uB2E8\uC5B4 \uAE30\uBC18 \uC644\uC804 \uC0AD\uC81C \uBC94\uC704: \uC778\uB371\uC2A4 ${w}~${v} (\uCD1D ${v-w+1}\uAC1C \uD56D\uBAA9)`);break}}}x&&p&&(console.log("  \u{1F4DD} \uC0C8\uB85C\uC6B4 \uD14D\uC2A4\uD2B8 \uCD94\uAC00 \uC900\uBE44"),console.log(`  \u{1F4CD} \uCD94\uAC00 \uC704\uCE58: (${p.x}, ${p.y})`),console.log(`  \u{1F4C4} \uC0C8 \uB0B4\uC6A9: "${y}"`),C.push({text:y,x:p.x,y:p.y,fontSize:f.font?.size||p.fontSize,fontName:f.font?.name||p.fontName,color:f.font?.color?(()=>{let m=this.parseColor(f.font.color);return o.rgb(m.r,m.g,m.b)})():o.rgb(0,.7,0),font:f.font,modificationIndex:s}),R++,console.log(`  \u2705 [\uC218\uC815\uC0AC\uD56D ${s+1}] \uBB38\uC7A5 \uC644\uC804 \uC0AD\uC81C \uD6C4 \uC0C8 \uB0B4\uC6A9 \uAD50\uCCB4 \uC644\uB8CC!`),console.log(`  \u{1F5D1}\uFE0F \uC0AD\uC81C\uB41C \uD56D\uBAA9 \uC218: ${I.size}\uAC1C`),console.log(`  \u2795 \uC0C8\uB85C \uCD94\uAC00\uB41C \uD14D\uC2A4\uD2B8: "${y}"`)),x||console.log(`  \u274C [\uC218\uC815\uC0AC\uD56D ${s+1}] \uBAA8\uB4E0 \uBB38\uC7A5 \uB2E8\uC704 \uB9E4\uCE6D \uC2DC\uB3C4 \uC2E4\uD328`)}}console.log(`
=== \uBB38\uC7A5 \uB2E8\uC704 \uC644\uC804 \uAD50\uCCB4 \uB80C\uB354\uB9C1 \uC2DC\uC791 ===`),console.log(`\u{1F5D1}\uFE0F \uC644\uC804 \uC0AD\uC81C\uD560 \uD14D\uC2A4\uD2B8 \uC218: ${I.size}\uAC1C`),console.log(`\u2795 \uC0C8\uB85C \uCD94\uAC00\uD560 \uD14D\uC2A4\uD2B8 \uC218: ${C.length}\uAC1C`),console.log(`\u{1F4C4} \uB0A8\uC740 \uC6D0\uBCF8 \uD14D\uC2A4\uD2B8 \uC218: ${i.textItems.length-I.size}\uAC1C`);let k=0;for(let s=0;s<i.textItems.length;s++){let f=i.textItems[s];if(I.has(s)){console.log(`  \u{1F5D1}\uFE0F \uC644\uC804 \uC0AD\uC81C\uB428 [${s}]: "${f.text}" (\uBB38\uC7A5 \uB2E8\uC704 \uC0AD\uC81C)`);continue}if(f.text&&f.text.trim().length>0){let d=f.text,y=o.rgb(0,0,0);console.log(`  \u{1F4DD} \uC6D0\uBCF8 \uD14D\uC2A4\uD2B8 \uC720\uC9C0 [${s}]: "${d}"`),k++;try{let u=f.x,x=f.y,w=Math.max(8,Math.min(f.fontSize,72)),v=this.containsKorean(d),p=v&&g?g:void 0;v&&g&&console.log(`    \u{1F1F0}\u{1F1F7} \uD55C\uAE00 \uD14D\uC2A4\uD2B8 \uAC10\uC9C0, \uD55C\uAE00 \uD3F0\uD2B8 \uC0AC\uC6A9: "${d}"`),console.log(`    \u{1F4CD} \uD14D\uC2A4\uD2B8 \uC704\uCE58: x=${u}, y=${x}, \uD06C\uAE30=${w}`),D.drawText(d,{x:u,y:x,size:w,font:p,color:y,opacity:1})}catch(u){console.warn(`\uD14D\uC2A4\uD2B8 \uADF8\uB9AC\uAE30 \uC2E4\uD328 [${s}]: "${d}"`,u);try{D.drawText(d,{x:f.x,y:f.y,size:Math.max(8,Math.min(f.fontSize,72)),color:y,opacity:1})}catch(x){console.error(`\uD14D\uC2A4\uD2B8 \uADF8\uB9AC\uAE30 \uC644\uC804 \uC2E4\uD328 [${s}]: "${d}"`,x)}}}}console.log(`  \u{1F4CA} \uC6D0\uBCF8 \uD14D\uC2A4\uD2B8 \uB80C\uB354\uB9C1 \uC644\uB8CC: ${k}\uAC1C \uD56D\uBAA9`),console.log(`
=== \uC0C8\uB85C\uC6B4 \uBB38\uC7A5 \uB0B4\uC6A9 \uCD94\uAC00 ===`);let B=0;for(let s of C){console.log(`  \u2795 \uC0C8 \uBB38\uC7A5 \uB0B4\uC6A9 \uCD94\uAC00 [${B+1}/${C.length}]: "${s.text}"`),console.log(`     \u{1F4CD} \uC704\uCE58: (${s.x}, ${s.y})`),console.log(`     \u{1F4CF} \uD06C\uAE30: ${s.fontSize}px`),console.log("     \u{1F3A8} \uD3F0\uD2B8 \uC2A4\uD0C0\uC77C:",s.font);try{let f=this.containsKorean(s.text),d;if(f)if(s.font?.weight==="bold")try{let u=yield this.loadKoreanBoldFont();u&&g?(d=yield c.embedFont(new Uint8Array(u)),console.log(`     \u{1F1F0}\u{1F1F7} Bold \uD55C\uAE00 \uD3F0\uD2B8 \uC801\uC6A9: "${s.text}"`)):(d=g,console.log(`     \u{1F1F0}\u{1F1F7} \uC77C\uBC18 \uD55C\uAE00 \uD3F0\uD2B8 \uC801\uC6A9 (Bold \uD3F0\uD2B8 \uBD88\uAC00): "${s.text}"`))}catch{d=g,console.log(`     \u{1F1F0}\u{1F1F7} \uC77C\uBC18 \uD55C\uAE00 \uD3F0\uD2B8 \uC801\uC6A9 (Bold \uC2E4\uD328): "${s.text}"`)}else d=g,console.log(`     \u{1F1F0}\u{1F1F7} \uC77C\uBC18 \uD55C\uAE00 \uD3F0\uD2B8 \uC801\uC6A9: "${s.text}"`);else{let u="Helvetica";if(s.font?.name){let x=s.font.name.toLowerCase();x.includes("times")?u=s.font.weight==="bold"?"Times-Bold":"Times-Roman":x.includes("courier")?u=s.font.weight==="bold"?"Courier-Bold":"Courier":(x.includes("helvetica")||x.includes("arial"),u=s.font.weight==="bold"?"Helvetica-Bold":"Helvetica")}else u=s.font?.weight==="bold"?"Helvetica-Bold":"Helvetica";s.font?.style==="italic"&&(u.includes("Times")?u=s.font.weight==="bold"?"Times-BoldItalic":"Times-Italic":u.includes("Helvetica")?u=s.font.weight==="bold"?"Helvetica-BoldOblique":"Helvetica-Oblique":u.includes("Courier")&&(u=s.font.weight==="bold"?"Courier-BoldOblique":"Courier-Oblique"));try{d=yield c.embedFont(o.StandardFonts[u]||o.StandardFonts.Helvetica),console.log(`     \u{1F524} \uC601\uBB38 \uD3F0\uD2B8 \uC801\uC6A9: "${s.text}", \uD3F0\uD2B8: ${u}`)}catch{d=yield c.embedFont(o.StandardFonts.Helvetica),console.log(`     \u{1F524} \uAE30\uBCF8 \uC601\uBB38 \uD3F0\uD2B8 \uC801\uC6A9 (\uD3F0\uD2B8 \uB85C\uB4DC \uC2E4\uD328): "${s.text}"`)}}let y={x:s.x,y:s.y,size:Math.max(8,Math.min(s.fontSize,72)),font:d,color:s.color,opacity:1};s.font?.letterSpacing&&(y.wordSpacing=s.font.letterSpacing),D.drawText(s.text,y),B++,console.log(`     \u2705 \uC0C8 \uBB38\uC7A5 \uCD94\uAC00 \uC131\uACF5! (\uD3F0\uD2B8: ${d?"\uC801\uC6A9\uB428":"\uAE30\uBCF8"}, \uD06C\uAE30: ${s.fontSize}px, \uC0C9\uC0C1: \uC801\uC6A9\uB428)`)}catch(f){console.warn(`     \u274C \uC0C8 \uBB38\uC7A5 \uADF8\uB9AC\uAE30 \uC2E4\uD328: "${s.text}"`,f);try{D.drawText(s.text,{x:s.x,y:s.y,size:Math.max(8,Math.min(s.fontSize,72)),color:s.color,opacity:1}),B++,console.log("     \u26A0\uFE0F \uAE30\uBCF8 \uD3F0\uD2B8\uB85C \uC0C8 \uBB38\uC7A5 \uCD94\uAC00 \uC131\uACF5")}catch(d){console.error(`     \u274C\u274C \uC0C8 \uBB38\uC7A5 \uADF8\uB9AC\uAE30 \uC644\uC804 \uC2E4\uD328: "${s.text}"`,d)}}}console.log(`
\u{1F4CA} \uD398\uC774\uC9C0 ${i.pageNum} \uBB38\uC7A5 \uB2E8\uC704 \uC644\uC804 \uAD50\uCCB4 \uACB0\uACFC:`),console.log(`   \u{1F5D1}\uFE0F \uC0AD\uC81C\uB41C \uD14D\uC2A4\uD2B8 \uD56D\uBAA9: ${I.size}\uAC1C`),console.log(`   \u{1F4DD} \uC720\uC9C0\uB41C \uC6D0\uBCF8 \uD14D\uC2A4\uD2B8: ${k}\uAC1C`),console.log(`   \u2795 \uC0C8\uB85C \uCD94\uAC00\uB41C \uBB38\uC7A5: ${B}\uAC1C`),console.log(`   \u2705 \uD398\uC774\uC9C0 ${i.pageNum} \uC7AC\uAD6C\uC131 \uC644\uB8CC`)}console.log(`
\u{1F389} \uC804\uCCB4 PDF \uBB38\uC7A5 \uB2E8\uC704 \uC644\uC804 \uAD50\uCCB4 \uC644\uB8CC!`),console.log(`\u{1F4CA} \uCD1D ${R}\uAC1C\uC758 \uBB38\uC7A5\uC774 \uC644\uC804\uD788 \uC0AD\uC81C\uB418\uACE0 \uC0C8\uB85C\uC6B4 \uB0B4\uC6A9\uC73C\uB85C \uAD50\uCCB4\uB428`),console.log(g?"\u2705 \uD55C\uAE00 \uD3F0\uD2B8 \uC784\uBCA0\uB4DC \uC131\uACF5\uC801\uC73C\uB85C \uC0AC\uC6A9\uB428":"\u26A0\uFE0F \uAE30\uBCF8 \uD3F0\uD2B8\uB85C \uD55C\uAE00 \uB80C\uB354\uB9C1 \uC2DC\uB3C4 (\uD55C\uAE00\uC774 \uAE68\uC9C8 \uC218 \uC788\uC74C)"),console.log("\uC0C8 PDF \uC800\uC7A5 \uC911...");let P=yield c.save({useObjectStreams:!1,addDefaultPage:!1,updateFieldAppearances:!1,objectsPerTick:50});try{let D=(yield o.PDFDocument.load(P)).getPageCount();console.log(`\u2705 \uC0C8 PDF \uAC80\uC99D \uC644\uB8CC: ${D}\uD398\uC774\uC9C0`)}catch(i){throw console.error("\uC0C8 PDF \uAC80\uC99D \uC2E4\uD328:",i),new Error("\uC0DD\uC131\uB41C PDF\uAC00 \uC190\uC0C1\uB418\uC5C8\uC2B5\uB2C8\uB2E4: "+i.message)}return console.log("PDF \uC644\uC804 \uC7AC\uC0DD\uC131 \uBC29\uC2DD \uD14D\uC2A4\uD2B8 \uC218\uC815 \uC644\uB8CC"),P.buffer}catch(o){throw console.error("PDF \uC644\uC804 \uC7AC\uC0DD\uC131 \uBC29\uC2DD \uC218\uC815 \uC911 \uC624\uB958:",o),o}})}analyzePdfContent(e,t){console.log("=== PDF \uB0B4\uC6A9 \uBD84\uC11D ===");let o=e.match(/\([^)]+\)/g)||[];console.log("\uBC1C\uACAC\uB41C \uAD04\uD638 \uD14D\uC2A4\uD2B8\uB4E4 (\uCC98\uC74C 20\uAC1C):",o.slice(0,20));let n=e.match(/<[0-9A-Fa-f]+>/g)||[];console.log("\uBC1C\uACAC\uB41C 16\uC9C4\uC218 \uD14D\uC2A4\uD2B8\uB4E4 (\uCC98\uC74C 10\uAC1C):",n.slice(0,10));let r=e.match(/[^a-zA-Z]\s*T[jJ]/g)||[];console.log("\uBC1C\uACAC\uB41C Tj/TJ \uD328\uD134\uB4E4 (\uCC98\uC74C 10\uAC1C):",r.slice(0,10));let a=e.indexOf(t);if(a!==-1){let c=e.substring(Math.max(0,a-100),a+100);console.log(`"${t}" \uBC1C\uACAC \uC704\uCE58 (${a}):`,c)}else console.log(`"${t}" \uD14D\uC2A4\uD2B8\uAC00 PDF\uC5D0 \uC5C6\uC74C`);let l=e.match(/stream\s*([\s\S]*?)\s*endstream/g)||[];console.log(`\uBC1C\uACAC\uB41C \uC2A4\uD2B8\uB9BC \uC218: ${l.length}`),l.length>0&&l[0]&&console.log("\uCCAB \uBC88\uC9F8 \uC2A4\uD2B8\uB9BC \uB0B4\uC6A9 (\uCC98\uC74C 200\uC790):",l[0].substring(0,200))}stringToHex(e){return Array.from(e).map(t=>t.charCodeAt(0).toString(16).padStart(2,"0")).join("").toUpperCase()}escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}arrayBufferToString(e){let t=new Uint8Array(e),o="";for(let n=0;n<t.length;n++)o+=String.fromCharCode(t[n]);return o}stringToArrayBuffer(e){let t=new ArrayBuffer(e.length),o=new Uint8Array(t);for(let n=0;n<e.length;n++)o[n]=e.charCodeAt(n)&255;return t}modifyPageContentStream(e,t,o){return $(this,null,function*(){try{console.log(`\uCF58\uD150\uCE20 \uC2A4\uD2B8\uB9BC\uC5D0\uC11C "${t}"\uB97C "${o}"\uB85C \uAD50\uCCB4 \uC2DC\uC791`);let n=e.node.Contents();if(!n){console.warn("\uCF58\uD150\uCE20 \uC2A4\uD2B8\uB9BC\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.");return}let r=Array.isArray(n)?n:[n];for(let a=0;a<r.length;a++){let l=r[a];try{let c=l.decode(),g=new TextDecoder("latin1").decode(c);console.log(`\uC2A4\uD2B8\uB9BC ${a+1} \uB0B4\uC6A9 (\uCC98\uC74C 500\uC790):`,g.substring(0,500));let E=[{regex:new RegExp(`\\(${this.escapeRegExp(t)}\\)\\s*Tj`,"g"),replacement:`(${o}) Tj`},{regex:new RegExp(`\\(${this.escapeRegExp(t)}\\)\\s*TJ`,"g"),replacement:`(${o}) TJ`},{regex:new RegExp(`<${this.stringToHex(t)}>\\s*Tj`,"gi"),replacement:`<${this.stringToHex(o)}> Tj`},{regex:new RegExp(`\\[\\(${this.escapeRegExp(t)}\\)\\]\\s*TJ`,"g"),replacement:`[(${o})] TJ`}],R=!1;for(let P of E){let i=g;g=g.replace(P.regex,P.replacement),g!==i&&(console.log("\uD328\uD134 \uB9E4\uCE6D \uC131\uACF5:",P.regex.source),console.log("\uAD50\uCCB4 \uACB0\uACFC:",P.replacement),R=!0)}if(R){let P=new TextEncoder().encode(g);l.encode(P),console.log(`\uC2A4\uD2B8\uB9BC ${a+1} \uC218\uC815 \uC644\uB8CC`)}else console.warn(`\uC2A4\uD2B8\uB9BC ${a+1}\uC5D0\uC11C "${t}" \uD14D\uC2A4\uD2B8\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC74C`)}catch(c){console.error(`\uC2A4\uD2B8\uB9BC ${a+1} \uCC98\uB9AC \uC911 \uC624\uB958:`,c)}}}catch(n){throw console.error("\uCF58\uD150\uCE20 \uC2A4\uD2B8\uB9BC \uC218\uC815 \uC911 \uC624\uB958:",n),n}})}loadPdfLib(){return $(this,null,function*(){try{return window.pdfjsLib||(console.log("PDF.js \uB77C\uC774\uBE0C\uB7EC\uB9AC \uB85C\uB529 \uC911..."),yield new Promise((e,t)=>{let o=document.createElement("script");o.src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js",o.onload=()=>{console.log("PDF.js \uB85C\uB529 \uC644\uB8CC"),window.pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js",e(!0)},o.onerror=()=>{t(new Error("PDF.js \uB85C\uB529 \uC2E4\uD328"))},document.head.appendChild(o)})),window.PDFLib||(console.log("pdf-lib \uB77C\uC774\uBE0C\uB7EC\uB9AC \uB85C\uB529 \uC911..."),yield new Promise((e,t)=>{let o=document.createElement("script");o.src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js",o.onload=()=>{console.log("pdf-lib \uB85C\uB529 \uC644\uB8CC"),e(window.PDFLib)},o.onerror=()=>{t(new Error("pdf-lib \uB85C\uB529 \uC2E4\uD328"))},document.head.appendChild(o)})),console.log("\uBAA8\uB4E0 PDF \uB77C\uC774\uBE0C\uB7EC\uB9AC \uB85C\uB529 \uC644\uB8CC"),window.PDFLib}catch(e){throw console.error("PDF \uB77C\uC774\uBE0C\uB7EC\uB9AC \uB85C\uB529 \uC624\uB958:",e),e}})}downloadModifiedPdf(e,t){let o=new Blob([e],{type:"application/pdf"}),n=URL.createObjectURL(o),r=document.createElement("a");r.href=n,r.download=t.replace(".pdf","_modified.pdf"),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n),console.log("\uC218\uC815\uB41C PDF \uB2E4\uC6B4\uB85C\uB4DC \uC644\uB8CC:",r.download)}modifyAndDownloadPdf(e,t){return $(this,null,function*(){try{if(console.log("=== PDF \uD14D\uC2A4\uD2B8 \uC2A4\uD2B8\uB9BC \uC218\uC815 \uC2DC\uC791 ==="),console.log("\uD30C\uC77C\uBA85:",e.name),console.log("\uD30C\uC77C \uD06C\uAE30:",e.size,"\uBC14\uC774\uD2B8"),console.log("\uC218\uC815\uC0AC\uD56D \uAC1C\uC218:",t.length),t.forEach((r,a)=>{console.log(`\uC218\uC815\uC0AC\uD56D ${a+1}:`,{pageIndex:r.pageIndex,originalText:r.originalText.substring(0,100)+(r.originalText.length>100?"...":""),newText:r.newText.substring(0,100)+(r.newText.length>100?"...":""),position:{x:r.x,y:r.y,width:r.width,height:r.height}})}),t.length===0){console.warn("\uC218\uC815\uC0AC\uD56D\uC774 \uC5C6\uC2B5\uB2C8\uB2E4. PDF \uC218\uC815\uC744 \uC911\uB2E8\uD569\uB2C8\uB2E4.");return}console.log("\uD30C\uC77C\uC744 ArrayBuffer\uB85C \uBCC0\uD658 \uC911...");let o=yield this.fileToArrayBuffer(e);console.log("ArrayBuffer \uBCC0\uD658 \uC644\uB8CC, \uD06C\uAE30:",o.byteLength,"\uBC14\uC774\uD2B8"),console.log("PDF \uD14D\uC2A4\uD2B8 \uC2A4\uD2B8\uB9BC \uC218\uC815 \uC2DC\uC791...");let n=yield this.modifyPdfTextStream(o,t);console.log("PDF \uD14D\uC2A4\uD2B8 \uC2A4\uD2B8\uB9BC \uC218\uC815 \uC644\uB8CC"),console.log("\uC218\uC815\uB41C PDF \uB2E4\uC6B4\uB85C\uB4DC \uC2DC\uC791..."),this.downloadModifiedPdf(n,e.name),console.log("PDF \uB2E4\uC6B4\uB85C\uB4DC \uC644\uB8CC"),console.log("=== PDF \uD14D\uC2A4\uD2B8 \uC2A4\uD2B8\uB9BC \uC218\uC815 \uC885\uB8CC ===")}catch(o){throw console.error("=== PDF \uC218\uC815 \uBC0F \uB2E4\uC6B4\uB85C\uB4DC \uC911 \uC624\uB958 ==="),console.error("\uC624\uB958 \uB0B4\uC6A9:",o),console.error("\uC624\uB958 \uC2A4\uD0DD:",o instanceof Error?o.stack:"No stack trace"),o}})}modifyPdfTextStreamAndGetUrl(e,t){return $(this,null,function*(){try{if(console.log("=== PDF \uD14D\uC2A4\uD2B8 \uC2A4\uD2B8\uB9BC \uC218\uC815 \uC2DC\uC791 (\uC7AC\uB85C\uB4DC\uC6A9) ==="),console.log("\uD30C\uC77C\uBA85:",e.name),console.log("\uD30C\uC77C \uD06C\uAE30:",e.size,"\uBC14\uC774\uD2B8"),console.log("\uC218\uC815\uC0AC\uD56D \uAC1C\uC218:",t.length),t.length===0)return console.warn("\uC218\uC815\uC0AC\uD56D\uC774 \uC5C6\uC2B5\uB2C8\uB2E4. PDF \uC218\uC815\uC744 \uC911\uB2E8\uD569\uB2C8\uB2E4."),{success:!1,error:"\uC218\uC815\uC0AC\uD56D\uC774 \uC5C6\uC2B5\uB2C8\uB2E4."};console.log("\uD30C\uC77C\uC744 ArrayBuffer\uB85C \uBCC0\uD658 \uC911...");let o=yield this.fileToArrayBuffer(e);console.log("ArrayBuffer \uBCC0\uD658 \uC644\uB8CC, \uD06C\uAE30:",o.byteLength,"\uBC14\uC774\uD2B8"),console.log("PDF \uD14D\uC2A4\uD2B8 \uC2A4\uD2B8\uB9BC \uC218\uC815 \uC2DC\uC791...");let n=yield this.modifyPdfTextStream(o,t);console.log("PDF \uD14D\uC2A4\uD2B8 \uC2A4\uD2B8\uB9BC \uC218\uC815 \uC644\uB8CC"),console.log("\uC218\uC815\uB41C PDF URL \uC0DD\uC131 \uC911...");let r=new Blob([n],{type:"application/pdf"}),a=URL.createObjectURL(r);return console.log("PDF URL \uC0DD\uC131 \uC644\uB8CC"),console.log("=== PDF \uD14D\uC2A4\uD2B8 \uC2A4\uD2B8\uB9BC \uC218\uC815 \uC885\uB8CC (\uC7AC\uB85C\uB4DC\uC6A9) ==="),{success:!0,newPdfUrl:a}}catch(o){return console.error("=== PDF \uC218\uC815 \uC911 \uC624\uB958 (\uC7AC\uB85C\uB4DC\uC6A9) ==="),console.error("\uC624\uB958 \uB0B4\uC6A9:",o),console.error("\uC624\uB958 \uC2A4\uD0DD:",o instanceof Error?o.stack:"No stack trace"),{success:!1,error:o instanceof Error?o.message:"\uC54C \uC218 \uC5C6\uB294 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4."}}})}fileToArrayBuffer(e){return new Promise((t,o)=>{let n=new FileReader;n.onload=()=>t(n.result),n.onerror=()=>o(n.error),n.readAsArrayBuffer(e)})}groupTextItemsBySentence(e){if(e.length===0)return[];let t=e.filter(l=>l.text&&l.text.trim().length>0).sort((l,c)=>{let g=l.y,E=c.y;return Math.abs(g-E)<3?l.x-c.x:E-g}),o=[],n=[],r=null,a=null;for(let l of t){let c=l.y,g=l.fontSize;if((r===null||Math.abs(c-r)>Math.min(g*.6,8)||a!==null&&Math.abs(g-a)>2||n.length>0&&Math.abs(l.x-(n[n.length-1].x+100))>200)&&n.length>0){let R=this.calculateSingleLineBounds(n),P=n.map(i=>i.text).join(" ").trim();P.length>0&&(o.push(L(N({},R),{items:[...n],text:P})),console.log(`  \u{1F4E6} \uBB38\uC7A5 \uADF8\uB8F9 \uC0DD\uC131: "${P}" (${n.length}\uAC1C \uD56D\uBAA9, Y=${R.y.toFixed(1)})`)),n=[]}n.push(l),r=c,a=g}if(n.length>0){let l=this.calculateSingleLineBounds(n),c=n.map(g=>g.text).join(" ").trim();c.length>0&&(o.push(L(N({},l),{items:[...n],text:c})),console.log(`  \u{1F4E6} \uB9C8\uC9C0\uB9C9 \uBB38\uC7A5 \uADF8\uB8F9 \uC0DD\uC131: "${c}" (${n.length}\uAC1C \uD56D\uBAA9, Y=${l.y.toFixed(1)})`))}return console.log(`\uD55C \uC904 \uB2E8\uC704 \uBB38\uC7A5 \uADF8\uB8F9\uD654 \uC644\uB8CC: ${e.length}\uAC1C \uD56D\uBAA9 \u2192 ${o.length}\uAC1C \uBB38\uC7A5 \uADF8\uB8F9`),o}calculateSingleLineBounds(e){if(e.length===0)return{x:0,y:0,width:0,height:0};let t=Math.min(...e.map(a=>a.x)),o=Math.max(...e.map(a=>a.x+(a.width||0))),n=e.reduce((a,l)=>a+l.y,0)/e.length,r=Math.max(...e.map(a=>a.fontSize||12));return{x:t,y:n,width:o-t,height:r*1.2}}calculateSimilarity(e,t){let o=new Set(e.toLowerCase().split(/\s+/)),n=new Set(t.toLowerCase().split(/\s+/)),r=new Set([...o].filter(l=>n.has(l))),a=new Set([...o,...n]);return r.size/a.size}isItemInGroup(e,t){return Math.abs(e.x-t.x)<=5&&Math.abs(e.y-t.y)<=t.height&&e.x>=t.x&&e.x<=t.x+t.width}isItemInSentenceGroup(e,t){let o=Math.min(t.height*.3,5),n=5;if(!(Math.abs(e.y-t.y)<=o))return!1;let a=t.items.some(g=>Math.abs(e.x-g.x)<=n&&Math.abs(e.y-g.y)<=o&&e.text.trim()===g.text.trim()),l=e.x>=t.x-n&&e.x<=t.x+t.width+n&&t.text.includes(e.text.trim()),c=a||l;return c&&console.log(`      \u2713 \uBB38\uC7A5 \uADF8\uB8F9 \uD3EC\uD568 \uD655\uC778: "${e.text}" (x=${e.x}, y=${e.y})`),c}static \u0275fac=function(t){return new(t||T)};static \u0275prov=M({token:T,factory:T.\u0275fac,providedIn:"root"})};export{U as a,Y as b,J as c};
